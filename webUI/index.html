<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>arXiv abstract search engine</title>
    <script
            src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.5/build/pure-min.css"
          integrity="sha384-LTIDeidl25h2dPxrB2Ekgc9c7sEC3CWGM6HeFmuDNUjX76Ert4Z4IY714dhZHPLd" crossorigin="anonymous">
</head>
<body>
<form class="pure-form pure-form-aligned">
    <fieldset>
        <div class="pure-g">
            <div class="pure-u-4-5">
                <div class="pure-u-2-3"><input id="queryString" name="queryString" placeholder="Type Words Here"
                                               class="pure-u-23-24"/>
                </div>
                <button id="bts" type="button" class="pure-button pure-button-primary" onclick="search()">Search
                </button>
                <button type="button" class="pure-button pure-button-primary" onclick="showAdvance()" id="advance">
                    Advance
                </button>
            </div>
            <div class="pure-u-1" id="advSearch" hidden>
                <div class="pure-u-4-5">
                    <div class="pure-u-1-3 pure-control-group"><label>Submitted After:</label> <input
                            name="timeStart"
                            id="timeStart"
                            type="month"
                            value="1971-01"/>
                    </div>
                    <div class="pure-u-1-3 pure-control-group"><label>Submitted Before:</label> <input
                            name="timeEnd"
                            type="month"
                            id="timeEnd"
                            value=""/></div>
                </div>
                <div class="pure-u-4-5">
                    <label>Article Categories</label>
                </div>
                <div class="pure-u-4-5">
                    <div class="pure-u-1-5">
                        <input type="checkbox" name="categories[]" checked="checked" value="astro-ph"/>
                        <label>Astrophysics</label>
                    </div>
                    <div class="pure-u-1-5">
                        <input type="checkbox" name="categories[]" checked="checked" value="cond-mat"/>
                        <label>Condensed Matter</label>
                    </div>
                    <div class="pure-u-1-5">
                        <input type="checkbox" name="categories[]" checked="checked" value="physics"/>
                        <label>Physics</label>
                    </div>
                    <div class="pure-u-1-5">
                        <input type="checkbox" name="categories[]" checked="checked" value="math"/>
                        <label>Mathematics</label>
                    </div>
                </div>
                <div class="pure-u-4-5">
                    <div class="pure-u-1-5">
                        <input type="checkbox" name="categories[]" checked="checked" value="nlin"/>
                        <label>Nonlinear Sciences</label>
                    </div>
                    <div class="pure-u-1-5">
                        <input type="checkbox" name="categories[]" checked="checked" value="cs"/>
                        <label>Computer Science</label>
                    </div>
                    <div class="pure-u-1-5">
                        <input type="checkbox" name="categories[]" checked="checked" value="q-bio"/>
                        <label>Quantitative Biology</label>
                    </div>
                    <div class="pure-u-1-5">
                        <input type="checkbox" name="categories[]" checked="checked" value="q-fin"/>
                        <label>Quantitative Finance</label>
                    </div>
                </div>
                <div class="pure-u-4-5">
                    <div class="pure-u-1-5">
                        <input type="checkbox" name="categories[]" checked="checked" value="stat"/>
                        <label>Statistics</label>
                    </div>
                    <div class="pure-u-1-5">
                        <input type="checkbox" name="categories[]" checked="checked" value="eess"/>
                        <label>Electrical Engineering</label>
                    </div>
                    <div class="pure-u-1-5">
                        <input type="checkbox" name="categories[]" checked="checked" value="econ"/>
                        <label>Economics</label>
                    </div>
                    <div class="pure-u-1-5">
                        <input type="checkbox" name="categories[]" checked="checked" value="other"/>
                        <label>Not Categorized</label>
                    </div>
                </div>
            </div>
        </div>

    </fieldset>
</form>
<div id="queryExpan" hidden>You may want to search <br>
<div id="qe-0" class="pure-u-1-6"></div>
<div id="qe-1" class="pure-u-1-6"></div>
<div id="qe-2" class="pure-u-1-6"></div>
<div id="qe-3" class="pure-u-1-6"></div>
<div id="qe-4" class="pure-u-1-6"></div>
</div>
<div id="searchResult">Search Results<br>
    <div id="result-0" class="pure-u-18-24"></div>
    <div id="result-1" class="pure-u-18-24"></div>
    <div id="result-2" class="pure-u-18-24"></div>
    <div id="result-3" class="pure-u-18-24"></div>
    <div id="result-4" class="pure-u-18-24"></div>
    <div id="result-5" class="pure-u-18-24"></div>
    <div id="result-6" class="pure-u-18-24"></div>
    <div id="result-7" class="pure-u-18-24"></div>
    <div id="result-8" class="pure-u-18-24"></div>
    <div id="result-9" class="pure-u-18-24"></div>
    <div id="result-10" class="pure-u-18-24"></div>
    <div id="result-11" class="pure-u-18-24"></div>
    <div id="result-12" class="pure-u-18-24"></div>
    <div id="result-13" class="pure-u-18-24"></div>
    <div id="result-14" class="pure-u-18-24"></div>
    <div id="result-15" class="pure-u-18-24"></div>
    <div id="result-16" class="pure-u-18-24"></div>
    <div id="result-17" class="pure-u-18-24"></div>
    <div id="result-18" class="pure-u-18-24"></div>
    <div id="result-19" class="pure-u-18-24"></div>
    <br>
    <button type="button" onclick="previous_page()" class="pure-button pure-button-disabled" id="previous_page">previous
        page
    </button>
    <div id="current_result"></div>
    <button type="button" onclick="next_page()" class="pure-button pure-button-disabled" id="next_page">next page
    </button>
</div>
<div id="recommend">Recommends<br>
    <div id="recommend-0" class="pure-u-18-24"></div>
    <div id="recommend-1" class="pure-u-18-24"></div>
    <div id="recommend-2" class="pure-u-18-24"></div>
    <div id="recommend-3" class="pure-u-18-24"></div>
    <div id="recommend-4" class="pure-u-18-24"></div>
    <div id="recommend-5" class="pure-u-18-24"></div>
    <div id="recommend-6" class="pure-u-18-24"></div>
    <div id="recommend-7" class="pure-u-18-24"></div>
    <div id="recommend-8" class="pure-u-18-24"></div>
    <div id="recommend-9" class="pure-u-18-24"></div>
</div>
<script type="text/javascript">
    var url = "";
    var now = new Date();
    var day = ("0" + now.getDate()).slice(-2);
    var month = ("0" + (now.getMonth() + 1)).slice(-2);
    var today = now.getFullYear() + "-" + (month);
    document.getElementById("timeEnd").value = (today);
    var offset = 0;
    var ss=getQueryVariable("search");
    if (ss!==false){
        document.getElementById("queryString").value=ss;
        search();
    }else{
        document.getElementById("recommend").hidden = true;

    }
    $("body").keydown(function () {
			if (event.keyCode == "13"){
				search();
				event.returnValue = false;
			}
		});
    function metasearch(uu) {
        $.ajax({
            url: uu,
            type: "get",
            dataType:'JSON',
            success: function (returnValue) {
                console.log(returnValue);
                document.getElementById("recommend").hidden = false;
                document.getElementById("queryExpan").hidden = false;
                document.getElementById("searchResult").hidden = false;
                var j;
                var ret_list = returnValue["ret_list"];

                for (j = 0; j < ret_list.length; j++) {
                    //console.log(j);
                    var divg = document.getElementById("result-" + j);
                    divg.innerHTML = "<p><a href=\"https://arxiv.canuse.xyz/document.html?arxiv_id="+ret_list[j][0]+"\" target=\"_blank\">arxiv id:" + ret_list[j][0] + " title:" + ret_list[j][1] + "</a> author " + ret_list[j][3] + " time " + ret_list[j][4] + "</p><p>abstract:" + ret_list[j][2] + "</p><p> </p>"
                }
                document.getElementById("current_result").innerHTML = "" + offset + "/" + returnValue.num;
                document.getElementById("previous_page").classList.remove("pure-button-disabled");
                document.getElementById("next_page").classList.remove("pure-button-disabled");
                if (offset === 0) {
                    document.getElementById("previous_page").classList.add("pure-button-disabled")
                }
                if (offset + 20 >= returnValue.num) {
                    document.getElementById("next_page").classList.add("pure-button-disabled")
                }


            },
            error: function (returnValue) {
                console.log("error");
                console.log(returnValue);
            }
        })
    }
    function queryExpansion(queryString){
        $.ajax({
            url: "https://arxiv.canuse.xyz/api/queryExpansion/?queryString="+queryString,
            type: "get",
            dataType:'JSON',
            success: function (returnValue) {
                console.log(returnValue);
                var j;
                var ret_list = returnValue["ret_list"];

                for (j = 0; j < 5; j++) {
                    var divg = document.getElementById("qe-" + j);
                    divg.innerHTML = "<a href=\"https://arxiv.canuse.xyz/index.html?search="+ret_list[j]+"\">"+ret_list[j]+"</a>";
                }
            },
            error: function (returnValue) {
                console.log("error");
                console.log(returnValue);
            }
        })
    }
    function search() {
        console.log("search");
        var i;
        var cat = ""
        for (i = 0; i < 11; i++) {
            if (document.getElementsByName("categories[]")[i].checked === false) {
                continue;
            }
            cat = cat + document.getElementsByName("categories[]")[i].value + ",";
        }
        if (document.getElementsByName("categories[]")[11].checked === true) {
            cat = cat + document.getElementsByName("categories[]")[11].value;
        }

        console.log(cat)
        url = "https://arxiv.canuse.xyz/api/query/?" + "queryString=" + document.getElementById("queryString").value + "&timeStart=" + document.getElementById("timeStart").value + "&timeEnd=" + document.getElementById("timeEnd").value + "&categories=" + cat;
        queryExpansion(document.getElementById("queryString").value);
        metasearch(url + "&offset=" + offset);
    }

    function previous_page() {
        offset = offset - 20;
        if (offset < 0) {
            offset = 0;
        }
        metasearch(url + "&offset=" + offset);
    }

    function next_page() {
        offset = offset + 20;
        metasearch(url + "&offset=" + offset);
    }

    function showAdvance() {
        console.log("show advance search");
        document.getElementById("advSearch").hidden = false;
    }
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        return (false);
    }
    function getRecommendArticle() {
        $.ajax({
            url: "https://arxiv.canuse.xyz/api/getRecommendArticle/",
            type: "get",
            dataType:'JSON',
            success: function (returnValue) {
                console.log(returnValue);
                var j;
                var ret_list = returnValue["ret_list"];

                for (j = 0; j < 10; j++) {
                    var divg = document.getElementById("recommend-" + j);
                    divg.innerHTML = divg.innerHTML = "<p><a href=\"https://arxiv.canuse.xyz/document.html?arxiv_id="+ret_list[j][0]+"\" target=\"_blank\">arxiv id:" + ret_list[j][0] + " title:" + ret_list[j][1] + "</a> author " + ret_list[j][3] + " category: " + ret_list[j][4]+"</p>";
                }
            },
            error: function (returnValue) {
                console.log("error");
                console.log(returnValue);
            }
        })
    }
</script>
</body>
</html>
